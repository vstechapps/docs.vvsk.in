<div class="viewer-overlay" (click)="onClose()">
    <div class="viewer-content" (click)="$event.stopPropagation()">
        <div class="viewer-header">
            <span class="file-name">{{ file?.name }}</span>
            <div class="actions">
                <div class="menu-container">
                    <button class="menu-btn" (click)="toggleMenu()">
                        <span class="material-icons">more_vert</span>
                    </button>
                    <div class="menu-backdrop" *ngIf="isMenuOpen" (click)="closeMenu()"></div>
                    <div class="dropdown-menu" *ngIf="isMenuOpen">
                        <button class="menu-item" (click)="onShareClick()">
                            <span class="material-icons">share</span>
                            Share
                        </button>
                        <button class="menu-item" (click)="onDownloadClick()">
                            <span class="material-icons">download</span>
                            Download
                        </button>
                    </div>
                </div>
                <button class="close-btn" (click)="onClose()">âœ•</button>
            </div>
        </div>
        <div class="viewer-body">
            <div *ngIf="loading && isPdf" class="loading-container">
                <div class="spinner"></div>
                <span>Loading PDF...</span>
            </div>
            <pdf-viewer *ngIf="isPdf" [src]="downloadUrl" [render-text]="true" [original-size]="false"
                style="width: 100%; height: 100%; display: block;" (after-load-complete)="onPdfLoadComplete()">
            </pdf-viewer>
            <img *ngIf="isImage" [src]="downloadUrl" alt="file" class="preview-image">
            <video *ngIf="isVideo" [src]="downloadUrl" controls class="preview-video"></video>
            <div *ngIf="!isPdf && !isImage && !isVideo" class="unsupported">
                <p>Preview not available for this file type.</p>
                <button class="download-link" (click)="onDownloadClick()">Download</button>
            </div>
        </div>
    </div>

    <!-- Signin Popup Overlay -->
    <div class="signin-overlay" *ngIf="showSigninPopup">
        <div class="signin-popup">
            <h3>Sign in required</h3>
            <p>Please sign in with Google to download this file.</p>
            <div class="popup-actions">
                <div *ngIf="isSigningIn" class="loader-container">
                    <div class="spinner"></div>
                </div>
                <ng-container *ngIf="!isSigningIn">
                    <button class="cancel-btn" (click)="closeSigninPopup()">Cancel</button>
                    <button class="signin-btn" (click)="onSignin()">Sign in</button>
                </ng-container>
            </div>
        </div>
    </div>

    <div class="toast" *ngIf="showToast">Link copied to clipboard</div>
</div>